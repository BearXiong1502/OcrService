/*
                         _oo0oo_
                        o8888888o
                        88" . "88
                        (| -_- |)
                        0\  =  /0
                      ___/`---'\___
                    .' \\|     |// '.
                   / \\|||  :  |||// \
                  / _||||| -:- |||||- \
                 |   | \\\  -  /// |   |
                 | \_|  ''\---/''  |_/ |
                 \  .-\__  '-'  ___/-. /
               ___'. .'  /--.--\  `. .'___
            ."" '<  `.___\_<|>_/___.' >' "".
           | | :  `- \`.;`\ _ /`;.`/ - ` : | |
           \  \ `_.   \_ __\ /__ _/   .-` /  /
       =====`-.____`.___ \_____/___.-`___.-'=====
                         `=---='
  
       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  
                 佛祖保佑         永无BUG
          本模块已经经过开光处理,绝无可能再产生BUG
*/
//
//
//   █████▒█    ██  ▄████▄   ██ ▄█▀       ██████╗ ██╗   ██╗ ██████╗
// ▓██   ▒ ██  ▓██▒▒██▀ ▀█   ██▄█▒        ██╔══██╗██║   ██║██╔════╝
// ▒████ ░▓██  ▒██░▒▓█    ▄ ▓███▄░        ██████╔╝██║   ██║██║  ███╗
// ░▓█▒  ░▓▓█  ░██░▒▓▓▄ ▄██▒▓██ █▄        ██╔══██╗██║   ██║██║   ██║
// ░▒█░   ▒▒█████▓ ▒ ▓███▀ ░▒██▒ █▄       ██████╔╝╚██████╔╝╚██████╔╝
//  ▒ ░   ░▒▓▒ ▒ ▒ ░ ░▒ ▒  ░▒ ▒▒ ▓▒       ╚═════╝  ╚═════╝  ╚═════╝
//  ░     ░░▒░ ░ ░   ░  ▒   ░ ░▒ ▒░
//  ░ ░    ░░░ ░ ░ ░        ░ ░░ ░
//           ░     ░ ░      ░  ░
// 


//
// 　　　┏┓　　　┏┓
// 　　┏┛┻━━━┛┻┓
// 　　┃　　　　┃
// 　　┃　　　━　　　 ┃
// 　　┃　┳┛　┗┳　┃
// 　　┃　　　　　　　 ┃
// 　　┃　　　┻　　　 ┃
// 　　┃　　　　　　　 ┃
// 　　┗━┓　　　┏━┛Codes are far away from bugs with the animal protecting
// 　　　　┃　　　┃    神兽保佑,代码无bug
// 　　　　┃　　　┃
// 　　　　┃　　　┗━━━┓
// 　　　　┃　　　　　 ┣┓
// 　　　　┃　　　　 ┏┛
// 　　　　┗┓┓┏━┳┓┏┛
// 　　　　　┃┫┫　┃┫┫
// 　　　　　┗┻┛　┗┻┛
//
// 　　　┏┓　　　┏┓
// 　　┏┛┻━━━┛┻┓
// 　　┃　　　　　　　 ┃ 　
// 　　┃　　　━　　　 ┃
// 　　┃　＞　　　＜┃
// 　　┃　　　　　　　 ┃
// 　　┃ . ⌒　..┃
// 　　┃　　　　　　　 ┃
// 　　┗━┓　　　┏━┛
// 　　　　┃　　　┃　Codes are far away from bugs with the animal protecting　　　　　　　
// 　　　　┃　　　┃ 神兽保佑,代码无bug
// 　　　　┃　　　┃　　　　　　　　　　　
// 　　　　┃　　　┃ 　　　　　　
// 　　　　┃　　　┃
// 　　　　┃　　　┃　　　　　　　　　　　
// 　　　　┃　　　┗━━━┓
// 　　　　┃　　　　　　　┣┓
// 　　　　┃　　　　　　　┏┛
// 　　　　┗┓┓┏━┳┓┏┛
// 　　　　　┃┫┫　┃┫┫
// 　　　　　┗┻┛　┗┻┛
//       ┏┓　　　┏┓+ +
//　　　┏┛┻━━━┛┻┓ + +
//　　　┃　　　　　　　┃ 　
//　　　┃　　　━　　　┃ ++ + + +
//　　 ████━████ ┃+
//　　　┃　　　　　　　┃ +
//　　　┃　　　┻　　　┃
//　　　┃　　　　　　　┃ + +
//　　　┗━┓　　　┏━┛
//　　　　┃　　　┃　　　　　　　　　　　
//　　　　┃　　　┃ + + + +
//　　　　┃　　　┃　　　　Codes are far away from bugs with the animal protecting　　　
//　　　　┃　　　┃ + 　　　　神兽保佑,代码无bug　　
//　　　　┃　　　┃
//　　　　┃　　　┃　　+　　　　　　　　　
//　　　　┃　 　 ┗━━━┓ + +
//　　　　┃ 　　　　  ┣┓
//　　　　┃ 　　　　 ┏┛
//　　　　┗┓┓┏━┳┓┏┛ + + + +
//　　　　 ┃┫┫ ┃┫┫
//　　　　　 ┗┻┛ ┗┻┛+ + + +
//                      d*##$.
// zP"""""$e.           $"    $o
//4$       '$          $"      $
//'$        '$        J$       $F
// 'b        $k       $>       $
//  $k        $r     J$       d$
//  '$         $     $"       $~
//   '$        "$   '$E       $
//    $         $L   $"      $F ...
//     $.       4B   $      $$$*"""*b
//     '$        $.  $$     $$      $F
//      "$       R$  $F     $"      $
//       $k      ?$ u*     dF      .$
//       ^$.      $$"     z$      u$$$$e
//        #$b             $E.dW@e$"    ?$
//         #$           .o$$# d$$$$c    ?F
//          $      .d$$#" . zo$>   #$r .uF
//          $L .u$*"      $&$$$k   .$$d$$F
//           $$"            ""^"$$$P"$P9$
//          JP              .o$$$$u:$P $$
//          $          ..ue$"      ""  $"
//         d$          $F              $
//         $$     ....udE             4B
//          #$    """"` $r            @$
//           ^$L        '$            $F
//             RN        4N           $
//              *$b                  d$
//               $$k                 $F
//               $$b                $F
//                 $""               $F
//                 '$                $
//                  $L               $
//                  '$               $
//                   $               $
//
//
//         ┌─┐       ┌─┐
//      ┌──┘ ┴───────┘ ┴──┐
//      │                 │
//      │       ───       │
//      │  ─┬┘       └┬─  │
//      │                 │
//      │       ─┴─       │
//      │                 │
//      └───┐         ┌───┘
//          │         │
//          │         │
//          │         │
//          │         └──────────────┐
//          │                        │
//          │                        ├─┐
//          │                        ┌─┘
//          │                        │
//          └─┐  ┐  ┌───────┬──┐  ┌──┘
//            │ ─┤ ─┤       │ ─┤ ─┤
//            └──┴──┘       └──┴──┘
//                神兽保佑
//                代码无BUG!

//
//                  ___====-_  _-====___
//            _--^^^#####//      \\#####^^^--_
//         _-^##########// (    ) \\##########^-_
//        -############//  |\^^/|  \\############-
//      _/############//   (@::@)   \\############\_
//     /#############((     \\//     ))#############\
//    -###############\\    (oo)    //###############-
//   -#################\\  / VV \  //#################-
//  -###################\\/      \//###################-
// _#/|##########/\######(   /\   )######/\##########|\#_
// |/ |#/\#/\#/\/  \#/\##\  |  |  /##/\#/  \/\#/\#/\#| \|
// `  |/  V  V  `   V  \#\| |  | |/#/  V   '  V  V  \|  '
//    `   `  `      `   / | |  | | \   '      '  '   '
//                     (  | |  | |  )
//                    __\ | |  | | /__
//                   (vvv(VVV)(VVV)vvv)
//                  神兽保佑
//                代码无BUG!

//                                                    __----~~~~~~~~~~~------___
//                                   .  .   ~~//====......          __--~ ~~
//                   -.            \_|//     |||\\  ~~~~~~::::... /~
//                ___-==_       _-~o~  \/    |||  \\            _/~~-
//        __---~~~.==~||\=_    -_--~/_-~|-   |\\   \\        _/~
//    _-~~     .=~    |  \\-_    '-~7  /-   /  ||    \      /
//  .~       .~       |   \\ -_    /  /-   /   ||      \   /
// /  ____  /         |     \\ ~-_/  /|- _/   .||       \ /
// |~~    ~~|--~~~~--_ \     ~==-/   | \~--===~~        .\
//          '         ~-|      /|    |-~\~~       __--~~
//                      |-~~-_/ |    |   ~\_   _-~            /\
//                           /  \     \__   \/~                \__
//                       _--~ _/ | .-~~____--~-/                  ~~==.
//                      ((->/~   '.|||' -_|    ~~-/ ,              . _||
//                                 -_     ~\      ~~---l__i__i__i--~~_/
//                                 _-~-__   ~)  \--______________--~~
//                               //.-~~~-~_--~- |-------~~~~~~~~
//                                      //.-~~~--\
//                  神兽保佑
//                代码无BUG!

//      ,----------------,              ,---------,
//         ,-----------------------,          ,"        ,"|
//       ,"                      ,"|        ,"        ,"  |
//      +-----------------------+  |      ,"        ,"    |
//      |  .-----------------.  |  |     +---------+      |
//      |  |                 |  |  |     | -==----'|      |
//      |  |  I LOVE DOS!    |  |  |     |         |      |
//      |  |  Bad command or |  |  |/----|`---=    |      |
//      |  |  C:\>_          |  |  |   ,/|==== ooo |      ;
//      |  |                 |  |  |  // |(((( [33]|    ,"
//      |  `-----------------'  |," .;'| |((((     |  ,"
//      +-----------------------+  ;;  | |         |,"
//         /_)______________(_/  //'   | +---------+
//    ___________________________/___  `,
//   /  oooooooooooooooo  .o.  oooo /,   \,"-----------
//  / ==ooooooooooooooo==.o.  ooo= //   ,`\--{)B     ,"
// /_==__==========__==_ooo__ooo=_/'   /___________,"
//
//                 .-~~~~~~~~~-._       _.-~~~~~~~~~-.
//             __.'              ~.   .~              `.__
//           .'//                  \./                  \\`.
//         .'//                     |                     \\`.
//       .'// .-~"""""""~~~~-._     |     _,-~~~~"""""""~-. \\`.
//     .'//.-"                 `-.  |  .-'                 "-.\\`.
//   .'//______.============-..   \ | /   ..-============.______\\`.
// .'______________________________\|/______________________________`.

//                               |~~~~~~~|
//                               |       |
//                               |       |
//                               |       |
//                               |       |
//                               |       |
//    |~.\\\_\~~~~~~~~~~~~~~xx~~~         ~~~~~~~~~~~~~~~~~~~~~/_//;~|
//    |  \  o \_         ,XXXXX),                         _..-~ o /  |
//    |    ~~\  ~-.     XXXXX`)))),                 _.--~~   .-~~~   |
//     ~~~~~~~`\   ~\~~~XXX' _/ ';))     |~~~~~~..-~     _.-~ ~~~~~~~
//              `\   ~~--`_\~\, ;;;\)__.---.~~~      _.-~
//                ~-.       `:;;/;; \          _..-~~
//                   ~-._      `''        /-~-~
//                       `\              /  /
//                         |         ,   | |
//                          |  '        /  |
//                           \/;          |
//                            ;;          |
//                            `;   .       |
//                            |~~~-----.....|
//                           | \             \
//                          | /\~~--...__    |
//                          (|  `\       __-\|
//                          ||    \_   /~    |
//                          |)     \~-'      |
//                           |      | \      '
//                           |      |  \    :
//                            \     |  |    |
//                             |    )  (    )
//                              \  /;  /\  |
//                              |    |/   |
//                              |    |   |
//                               \  .'  ||
//                               |  |  | |
//                               (  | |  |
//                               |   \ \ |
//                               || o `.)|
//                               |`\\\\) |
//                               |       |
//                               |       |


/*
        11111111111111111111111111111111111111001111111111111111111111111
        11111111111111111111111111111111111100011111111111111111111111111
        11111111111111111111111111111111100001111111111111111111111111111
        11111111111111111111111111111110000111111111111111111111111111111
        11111111111111111111111111111000000111111111111111111111111111111
        11111111111111111111111111100000011110001100000000000000011111111
        11111111111111111100000000000000000000000000000000011111111111111
        11111111111111110111000000000000000000000000000011111111111111111
        11111111111111111111111000000000000000000000000000000000111111111
        11111111111111111110000000000000000000000000000000111111111111111
        11111111111111111100011100000000000000000000000000000111111111111
        11111111111111100000110000000000011000000000000000000011111111111
        11111111111111000000000000000100111100000000000001100000111111111
        11111111110000000000000000001110111110000000000000111000011111111
        11111111000000000000000000011111111100000000000000011110001111111
        11111110000000011111111111111111111100000000000000001111100111111
        11111111000001111111111111111111110000000000000000001111111111111
        11111111110111111111111111111100000000000000000000000111111111111
        11111111111111110000000000000000000000000000000000000111111111111
        11111111111111111100000000000000000000000000001100000111111111111
        11111111111111000000000000000000000000000000111100000111111111111
        11111111111000000000000000000000000000000001111110000111111111111
        11111111100000000000000000000000000000001111111110000111111111111
        11111110000000000000000000000000000000111111111110000111111111111
        11111100000000000000000001110000001111111111111110001111111111111
        11111000000000000000011111111111111111111111111110011111111111111
        11110000000000000001111111111111111100111111111111111111111111111
        11100000000000000011111111111111111111100001111111111111111111111
        11100000000001000111111111111111111111111000001111111111111111111
        11000000000001100111111111111111111111111110000000111111111111111
        11000000000000111011111111111100011111000011100000001111111111111
        11000000000000011111111111111111000111110000000000000011111111111
        11000000000000000011111111111111000000000000000000000000111111111
        11001000000000000000001111111110000000000000000000000000001111111
        11100110000000000001111111110000000000000000111000000000000111111
        11110110000000000000000000000000000000000111111111110000000011111
        11111110000000000000000000000000000000001111111111111100000001111
        11111110000010000000000000000001100000000111011111111110000001111
        11111111000111110000000000000111110000000000111111111110110000111
        11111110001111111100010000000001111100000111111111111111110000111
        11111110001111111111111110000000111111100000000111111111111000111
        11111111001111111111111111111000000111111111111111111111111100011
        11111111101111111111111111111110000111111111111111111111111001111
        11111111111111111111111111111110001111111111111111111111100111111
        11111111111111111111111111111111001111111111111111111111001111111
        11111111111111111111111111111111100111111111111111111111111111111
        11111111111111111111111111111111110111111111111111111111111111111


        */

using Autofac;
using OcrServices.DataAccess;
using System;
using System.Collections.Generic;
using System.Configuration;
using System.Diagnostics;
using System.Framework.Common;
using System.Framework.Logging;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading;
using System.Threading.Tasks;

namespace OcrServices
{
    class Program
    {
        private static readonly string OcrJsonBackupDirectory = ConfigurationManager.AppSettings["OcrJsonBackupDirectory"] ?? "";
        static void Main(string[] args)
        {
            //var list = new List<ImageInfoByHpList>
            //{
            //    new ImageInfoByHpList(1, "a", "path", "hpid", "source", ""),
            //    new ImageInfoByHpList(2, "a", "path", "hpid", "source", ""),
            //    new ImageInfoByHpList(3, "a", "path", "hpid", "source", "")
            //};
            //var sss = list.Select(x => new {ImKy = $"{x.ImimKy}", x.SourceType, coords = x.Coords}).ToJson();
            //Console.Read();

            //var ss = "{\"RotateAngle\":3,\"Polygon\":[{\"X\":27.3541183,\"Y\":416.906219},{\"X\":31.2618389,\"Y\":164.857346},{\"X\":1289.55212,\"Y\":217.61171},{\"X\":1365.75293,\"Y\":360.244049},{\"X\":1365.75293,\"Y\":360.244049}]}";
            //var data = ss.FromJson<dynamic>();
            //string pointsaa = data.Polygon.ToString().Replace("\r\n","").Replace("\"", "");
            //var aaa = pointsaa.FromJson<dynamic[]>(pointsaa).Select(x => new { X = x["X"].ToString(), Y = x["Y"].ToString() }).ToArray();

            //var ssfsdf = "";
            //192.168.102.61 : OCR程序托管,生产环境-弃用(2018-05-09换成新服务器192.168.102.32),
            //192.168.102.32 : OCR程序托管,生产环境
            //http://192.168.102.20:8888 uat 发送url


            // DownloadConfig dddd = new DownloadConfig();

            // Dictionary<string, string> dict = new Dictionary<string, string>()
            // {
            //     {"key1", "value1"},
            //     {"key2","value2" }
            // };
            // dddd.ConnectionStringDictionary = dict;
            // var json = dddd.ToJson();


            //var sss =  ConnectionStringConfig<SPIN_CLIV_INSERT_OCR>.GetConnectionString(dict);

            // Console.ReadLine();
            //string server = "192.168.102.188";
            //string port = "8888";
            //string user = "share";
            //string pwd = "share123";//老密码,2017-09-13弃用,补:2018-05-09uat、prd密码更新
            //var test = new BearTest
            //{
            //    pTKTK_KY = new List<IMIM_PATH> { new IMIM_PATH { IMIM_PATH_NAME = "gagag" }, new IMIM_PATH { IMIM_PATH_NAME = "asdfafda" } }.ToSqlDataRecord().ToList(),
            //    test = "text"
            //};
            //_commonBl.Execute(test);

            string path = $@"{AppDomain.CurrentDomain.BaseDirectory}\{ConfigurationManager.AppSettings["OcrServiceConfig"] ?? ""}";
            if (!File.Exists(path))
            {
                Console.WriteLine($"OcrConfig:{path}");
                Console.WriteLine("请提供Ftp配置文件,5秒后程序将自动退出...");
                Thread.Sleep(5000);
                return;
            }
            Console.WriteLine($"配置环境:{Path.GetFileName(path).Left(3)}");

            string configs = File.ReadAllText(path).Replace("\r\n", "");
            var downloadConfigs = configs.FromJson<List<DownloadConfig>>();
            StringBuilder stb = new StringBuilder();
            foreach (var config in downloadConfigs)
            {
                stb.Clear();
                stb.AppendLine($"开始检查 {config.SourceServerIp}{config.NLogName} 配置.....");
                stb.AppendLine($"下载文件将下载至 {Path.GetFileName(config.TargetServerPath)} 目录");
                stb.AppendLine($"{config.SourceServerIp}{config.NLogName} 配置 √");
                Console.WriteLine(stb);
            }

            var taskList = new List<Task>();
            taskList.AddRange(downloadConfigs.Select(f => Task.Factory.StartNew(x =>
            {
                var down = Containers.Resolve<IDownload>(f.ServiceName, new NamedParameter("nLogName", f.NLogName), new NamedParameter("cloudConfig", f.CloudConfig));
                var proxy = Containers.Resolve<IRpcProxy>("IRpcProxy", new NamedParameter("rpcUrl", f.RpcUrl));
                while (true) BeginWork(down, f, proxy);
            }, 1)));

            taskList.AddRange(downloadConfigs.Select(f => Task.Factory.StartNew(x =>
            {
                while (true) BeginGetOcrResult(f);
            }, 1)));

            //taskList.Add(Task.Factory.StartNew(x =>
            //{
            //    while (true) { foreach (var f in downloadConfigs) BeginGetOcrResult(f); Thread.Sleep(10000); }
            //}, 1));
            //foreach (var f in downloadConfigs) BeginGetOcrResult(f);
            Task.WaitAll(taskList.ToArray());

        }

        static void BeginWork(IDownload down, DownloadConfig config, IRpcProxy proxy)
        {
            try
            {
                //调用sp 获取imimKy batchNo imimPath
                var callDataBase = Containers.Resolve<ICallDataBase>(config.CallDataBaseServiceName);
                var data = callDataBase.FindData(config);
                //var data = Enumerable.Range(1, 16).Select(x => new ImageInfo { ImimKy = x.ToJson(), BatchNo = "5", ImimPath = $@"C:\Users\sh179\Desktop\testx\{x}.jpg" }).ToList();

                var batchNos = data.Select(x => x.BatchNo).Distinct().ToList();
                Nlog.Info(down.NLogName, $"{config.SourceServerIp}{down.NLogName} 批次 down star,count:{batchNos.Count}");
                foreach (var item in batchNos)
                {
                    var directoryName = $"{config.SourceServerIp}{item}";
                    var path = $@"{config.TargetServerPath}\{directoryName}";
                    if (!Directory.Exists(path)) Directory.CreateDirectory(path);
                    var list = data.Where(x => x.BatchNo == item).DefaultIfEmpty().ToList();

                    Nlog.Info(down.NLogName, $"{config.SourceServerIp}{down.NLogName} image down star,count:{list.Count}\tBatchNo:{item}");
                    Parallel.ForEach(list, new ParallelOptions { MaxDegreeOfParallelism = int.Parse(config.MaxDegreeOfParallelism) }, f => f.IsSuccess = down.Download(f.ImimPath, $@"{path}\{config.SourceServerIp}{f.ImimKy}{(Path.GetExtension(f.ImimPath)?.ToLower() == "" ? ".jpg" : Path.GetExtension(f.ImimPath)?.ToLower())}"));
                    Nlog.Info(down.NLogName, $"{config.SourceServerIp}{down.NLogName} image down end,count:{list.Count(x => x.IsSuccess)}");

                    string result = "未接收到";
                    try
                    {
                        callDataBase.SendJson(list.Where(x => x.IsSuccess).ToList(), config);
                        result = proxy.SendMessage(config.CallDataBaseServiceName, $"{directoryName}");
                        //todo:批次全部发送成功，跟新数据库
                        if (result.ToLower() == "ok")
                            callDataBase.SendImage(list.Where(x => x.IsSuccess).ToList(), config);
                        Nlog.Info(down.NLogName, $"{config.SourceServerIp}{down.NLogName} Ocr.Send:{item} Ocr.Result:{result}");
                    }
                    catch (Exception ex)
                    {
                        Nlog.Info(down.NLogName, $"{config.SourceServerIp}{down.NLogName} Ocr.Send:{item} Ocr.Result:{result}.Catch:{ex.Message}");
                    }
                    Thread.Sleep(1000);
                }
                if (batchNos.Count > 0) Nlog.Info(down.NLogName, $"{config.SourceServerIp}{down.NLogName} 批次 down end!\r\n\r\n");
            }
            catch (Exception ex) { Nlog.Info($"{config.NLogName}", $"beginwork catch:{config.SourceServerIp}.{ex.Message}"); }
            Thread.Sleep(config.SendMillisecondsTimeout);
        }

        static void BeginGetOcrResult(DownloadConfig config)
        {
            //try
            //{
            //    //删除空文件夹
            //    foreach (var item in Directory.GetDirectories(config.TargetServerPath))
            //    {
            //        var dir = new DirectoryInfo(item);
            //        if (dir.GetFiles().Length == 0) Directory.Delete(item);
            //    }
            //}
            //catch (Exception ex) { Nlog.Info($"{config.NLogName}.json", $"Directory.Delete catch:{config.SourceServerIp}.{ex.Message}"); }

            try
            {
                Stopwatch sw = new Stopwatch();
                sw.Start();
                var jsons = Directory.GetFiles(config.TargetServerPath, "*.json.ok", SearchOption.AllDirectories);
                sw.Stop();

                Nlog.Info($"{config.NLogName}.json", $"{config.SourceServerIp}{config.NLogName} 获取到json.Count:{jsons.Length} 耗时:{sw.Elapsed}");
                var database = Containers.Resolve<ICallDataBase>(config.CallDataBaseServiceName);
                foreach (var item in jsons)
                {
                    var fileName = Path.GetFileName(item) ?? "";
                    var sourceServerIp = fileName.Substring(0, config.SourceServerIp.Length);
                    if (sourceServerIp != config.SourceServerIp) continue;
                    try
                    {
                        string json = File.ReadAllText(item).Replace("\r\n", "");
                        var result = database.GetResult(int.Parse(fileName.Replace(config.SourceServerIp, "").Replace(".json.ok", "")), json, config, json.Length > 10);
                        Nlog.Info($"{config.NLogName}.json", $"{fileName} json result:{(json.Length > 10 ? "√" : "╳")},input database:{(result ? "√" : "╳")}");

                        //File.Delete(item);
                        var backupDirectory = $@"{OcrJsonBackupDirectory}\{config.SourceServerIp}\{config.CallDataBaseServiceName}\{DateTime.Now:yyyy-MM-dd}";
                        if (!Directory.Exists(backupDirectory)) Directory.CreateDirectory(backupDirectory);
                        File.Move(item, $@"{backupDirectory}\{DateTime.Now:yyyy.MM.dd HH.mm.ss.fff}.{fileName}");
                    }
                    catch (Exception ex) { Nlog.Info($"{config.NLogName}.json", $"move json catch:{config.SourceServerIp}{item}.{ex.Message}"); }
                    Thread.Sleep(0);
                }
            }
            catch (Exception ex) { Nlog.Info($"{config.NLogName}.json", $"getresult catch:{ex.Message}"); }
            Thread.Sleep(config.SendMillisecondsTimeout);
        }
    }

    public class PointF
    {
        public float X;
        public float Y;
    }
}
